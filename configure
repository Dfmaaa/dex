#!/bin/sh

. scripts/configure.sh || exit 1

check_cflags()
{
	check_cc_flag -std=gnu99 -pipe -Wall -Wshadow -Wcast-align -Wpointer-arith \
		-Wwrite-strings -Wundef -Wmissing-prototypes -Wredundant-decls

	for i in -Wdeclaration-after-statement \
		-Wold-style-definition \
		-Wno-pointer-sign \
		-Werror-implicit-function-declaration
	do
		check_cc_flag $i
	done
	return 0
}

# defaults
prefix=/usr/local
bindir=
datadir=
DEBUG=1
DEBUG_SYNTAX=0

USAGE="
Options:
  prefix          Installation prefix    [$prefix]
  bindir          User executables       [\$prefix/bin]
  datadir         Read-only data         [\$prefix/share]

Also many standard variables like CC are recognized."

parse_command_line "$@"

CFLAGS="$CFLAGS -DDEBUG=$DEBUG"
CFLAGS="$CFLAGS -DDEBUG_SYNTAX=$DEBUG_SYNTAX"

var_default bindir "${prefix}/bin"
var_default datadir "${prefix}/share"

check check_cc
check check_cflags
check check_cc_depgen

makefile_vars bindir datadir
generate_config_mk
