# @charset at-rule at very beginning of file
# @import at-rule before any other rules
# @namespace at-rule must follow @charset and @import rules, and precede all other at-rules
#
# other at-rules: @media @page @font-face

# comment
syntax .css-comment

state start comment
	char "*" comment
	recolor code 1
	noeat END

state comment
	char "*" star
	eat comment

state star comment
	char / END comment
	noeat comment

# hex escape: \[0-9a-fA-F]{1-6}
# one hex digit already eaten
# can be terminated with whitespace character which is skipped
syntax .css-hex

state hex1 special
	char 0-9a-fA-F hex2
	noeat end

state hex2 special
	char 0-9a-fA-F hex3
	noeat end

state hex3 special
	char 0-9a-fA-F hex4
	noeat end

state hex4 special
	char 0-9a-fA-F hex5
	noeat end

state hex5 special
	char 0-9a-fA-F end special
	noeat end

state end
	# whitespace is always skipped, even if there are 6 hex digits!
	char "\t\n\r " END special
	noeat END

# double quote
syntax .css-dq

state string
	char \" END string
	char \\ esc
	char "\n" END error
	eat string

state esc special
	# \\ + \n -> continue to next line
	char "\n\\\"" string special
	char 0-9a-fA-F .css-hex:string
	eat string error

# single quote
syntax .css-sq

state string
	char \' END string
	char \\ esc
	char "\n" END error
	eat string

state esc special
	# \\ + \n -> continue to next line
	char "\n\\'" string special
	char 0-9a-fA-F .css-hex:string
	eat string error

# url(...)
syntax .css-url

state url
	char \" .css-dq:end
	char \' .css-sq:end
	noeat plain

state plain code
	char ) END url
	char "\n" END error
	eat plain

state end
	char ) END url
	eat END error

# main syntax
syntax css

state verybeginning
	# these 9 bytes exactly + double quote
	str '@charset ' charset
	noeat start

state charset atkeyword
	char \" .css-dq:atend
	eat start error

state atend code
	char "\t\n " atend
	char \; start
	eat start-error

state start code
	char " \t\n" start
	char -b a-zA-Z tag
	char . class
	char # id
	char \{ block
	char 0-9_- start-error
	char / .css-comment:start
	eat start

state tag
	char -b a-zA-Z0-9 tag
	char _- start-error
	# temporary state needed state to stop buffering
	noeat tmp

state tmp
	char -b : pseudo
	noeat start

state pseudo code
	char -b a-zA-Z0-9:- pseudo
	inlist pseudoclass start
	inlist exprpseudo nth pseudoclass
	inlist pseudoelement start
	bufis -i :lang complexpseudo
	bufis -i :not complexpseudo
	noeat start

# lang(indetifier) { ... }
# not(table) { ... }
state complexpseudo pseudoclass
	char ( complexexpr
	eat start-error

# nth-child(odd|even|an+b) etc.
state nth
	char ( nthexpr
	eat start-error

state nthexpr expr
	char a-z0-9+- nthexpr
	char ) start expr
	eat start-error

state complexexpr expr
	char ) start expr
	char -n "\n" complexexpr
	noeat start

state class
	char a-zA-Z0-9_- class
	char -b : pseudo
	noeat start

state id
	char a-zA-Z0-9_- id
	char -b : pseudo
	noeat start

state block code
	char " \t\n;" block
	char -b a-zA-Z- property
	char 0-9_- property-error
	char } start
	char / .css-comment:block
	eat block

state property code
	char -b a-zA-Z- property
	char 0-9_ property-error
	inlist property property-end
	# could be unknown property
	noeat property-end

state property-end code
	char : values
	char " \t\n" property-end
	char ";" block
	char } start
	eat property-error

state values code
	char " \t\n" values
	char 0-9 int
	char -- - minus
	char # hexcolor
	char ";" block
	char \" .css-dq:values
	char \' .css-sq:values
	str "url(" .css-url:values
	char -b a-zA-Z_ value
	char } start
	eat values

state minus numeric
	char 0-9 int
	char . float
	noeat values

state int numeric
	char 0-9 int
	char . float
	char -b a-zA-Z% unit
	noeat values

state float numeric
	char 0-9 float
	char -b a-zA-Z% unit
	noeat values

state unit error
	char -b a-zA-Z% unit
	inlist unit values numeric
	char ";" block
	char } start
	eat value-error

state value code
	char -b a-zA-Z0-9_- value
	inlist value values
	inlist color values
	inlist func func value
	noeat values

# FIXME: length must be 3 or 6
state hexcolor color
	char 0-9a-fA-F hexcolor
	char g-zG-Z_- value-error
	noeat values

state func code
	char " \t" func
	char ( params
	eat value-error

state params code
	char ) values
	char ";" block
	char } start
	eat params

state start-error error
	char a-zA-Z0-9_- start-error
	noeat start

state property-error error
	char a-zA-Z0-9_- property-error
	noeat property

state value-error error
	char a-zA-Z0-9_- value-error
	noeat values

list -i property \
	background background-attachment background-color \
	background-image background-position background-repeat \
	border border-bottom border-bottom-width border-color \
	border-left border-left-width border-right border-right-width \
	border-style border-top border-top-width border-width \
	clear color display float \
	font font-family font-size font-style font-variant font-weight \
	height letter-spacing line-height \
	list-style list-style-image list-style-position list-style-type \
	margin margin-bottom margin-left margin-right margin-top \
	padding padding-bottom padding-left padding-right padding-top \
	text-align text-decoration text-indent text-transform \
	vertical-align white-space width word-spacing \
	border-bottom-color border-bottom-style border-collapse \
	border-left-color border-left-style border-right-color \
	border-right-style border-spacing border-top-color \
	border-top-style bottom caption-side clip content \
	counter-increment counter-reset cursor direction empty-cells \
	left max-height max-width min-height min-width \
	orphans outline outline-color outline-style outline-width \
	overflow page-break-after page-break-before page-break-inside \
	position quotes right table-layout text-shadow top \
	unicode-bidi visibility widows z-index

list -i value \
	absolute always armenian auto avoid baseline bidi-override blink \
	block bold bolder both bottom capitalize center circle \
	cjk-ideographic collapse compact condensed crop cross crosshair \
	dashed decimal decimal-leading-zero default disc dotted double \
	e-resize embed expanded extra-condensed extra-expanded fixed \
	georgian groove hebrew help hidden hide hiragana hiragana-iroha \
	inline inline-table inset inside italic justify katakana \
	katakana-iroha landscape large larger left lighter line-through \
	list-item lower-alpha lower-greek lower-latin lower-roman lowercase \
	ltr marker medium middle move n-resize narrower ne-resize no-repeat \
	none normal nowrap nw-resize oblique outset outside overline pointer \
	potrait pre relative repeat repeat-x repeat-y ridge right rtl run-in \
	s-resize scroll se-resize semi-condensed semi-expanded separate show \
	small small-caps smaller solid square static sub super sw-resize \
	table table-caption table-cell table-column table-column-group \
	table-footer-group table-header-group table-row table-row-group text \
	text-bottom text-top thick thin top ultra-condensed ultra-expanded \
	underline upper-alpha upper-latin upper-roman uppercase visible \
	w-resize wait wider x-large x-small xx-large xx-small

list -i color \
	aqua black blue fuchsia gray green lime maroon navy olive \
	purple red silver teal white yellow

# simple pseudo-classes
list -i pseudoclass \
	:active :checked :disabled :empty :enabled :first-child \
	:first-of-type :focus :hover :last-child :last-of-type :link \
	:only-child :only-of-type :root :target :visited

# nth-child(odd) etc.
list -i exprpseudo :nth-child :nth-last-child :nth-last-of-type :nth-of-type

# CSS1 and CSS2 pseudo-elements can be prefixed with single colon
# CSS2.1 changed pseudo-elements start with a double colon
# support only dobule colon for CSS3 pseudo-elements
list -i pseudoelement \
	:after :before :first-letter :first-line \
	::after ::before ::first-letter ::first-line \
	::selection

list -i unit \
	% cm em ex in mm pc pt px

list -i func \
	attr clip counter rect rgb

default keyword property
default type class id pseudoclass pseudoelement
default special expr
default constant value color url
default special atkeyword
